<!DOCTYPE html>
<html>
<head>
  <title>Calcular Combust√≠vel</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      padding: 0;
      color: white;
      font-family: Arial, sans-serif;
      background-color: black; /* cor de fundo padr√£o */
    }

    /* Modo invertido (Luz acesa) */
    .invert {
      background-color: white;
      color: black;
    }

    h1 {
      margin-top: 0;
    }

    .divgeral {
      display: flex;
      justify-content: center;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }

    form {
      display: flex;
      flex-direction: column;
      width: fit-content;
      margin-bottom: 1rem;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 1rem;
      border-radius: 0.5rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
    }

    input {
      margin-bottom: 1rem;
      padding: 0.5rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    button.calcular {
      background-color: #00BFFF;
      font-weight: bold;
      height: 30px;
      border: none;
      border-radius: 0.3rem;
      cursor: pointer;
    }

    button {
      margin-top: 1rem;
      cursor: pointer;
    }

    li {
      font-size: 14px;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 0.3rem;
      margin-bottom: 0.2rem;
      border-radius: 0.3rem;
    }

    @media screen and (max-width: 480px) {
      li {
        font-size: 11px;
      }
    }

    .abasteca {
      font-size: 18px;
      font-weight: bold;
    }

    /* POPUP GEN√âRICO (alert/confirm customizado) */
    .popup {
      display: none;
      position: fixed;
      left: 50%;
      top: 40%;
      transform: translate(-50%, -50%);
      background: #006400;
      border: 2px solid black;
      padding: 20px;
      width: 350px;
      z-index: 9999;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
      border-radius: 0.5rem;
      color: white;
    }

    #closeButton, #closeButtonGeneral {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: transparent;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: white;
    }

    .popup button {
      margin-top: 1rem;
    }

    /* Popup EXCLUSIVO do Premium */
    #popup {
      background: green;
    }

    /* Popup GEN√âRICO */
    #generalPopup {
      background: rgba(0, 0.5, 0.5, 0.95);
    }

    /* √çcone de remover item no hist√≥rico (X) */
    .delete-icon {
      color: red;
      margin-left: 10px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>

<body onload="carregarValores(); atualizarBotaoLuz();">
  <div class="divgeral">
    <!-- BOT√ïES SUPERIORES -->
    <div style="text-align: center;">
      <button onclick="abrirPremium()">üîí Acesso Premium</button>
      <button id="luzButton" onclick="inverterCores()">üí° Luz</button>
      <br><br>
      <h1>Calcular Combust√≠vel</h1>
    </div>

    <!-- FORMUL√ÅRIO -->
    <div>
      <form>
        <label for="precoGasolina">‚õΩ Pre√ßo da Gasolina:</label>
        <input type="tel" id="precoGasolina" name="precoGasolina" 
               placeholder="Digite somente n√∫meros"
               onfocus="this.select()" oninput="adicionarVirgula(this)" onblur="formatarCampo(this)">

        <label for="precoAlcool">üç∫ Pre√ßo do √Ålcool (Etanol):</label>
        <input type="tel" id="precoAlcool" name="precoAlcool" 
               placeholder="Digite somente n√∫meros"
               onfocus="this.select()" oninput="adicionarVirgula(this)" onblur="formatarCampo(this)">

        <label for="kmLitro">üöô KM/L do Autom√≥vel (opcional):</label>
        <input type="number" step="0.01" id="kmLitro" name="kmLitro" 
               placeholder="Digite somente n√∫meros" onfocus="this.select()">

        <label for="distancia">üó∫Ô∏è Dist√¢ncia a percorrer (KM) (opcional):</label>
        <input type="number" id="distancia" name="distancia" 
               placeholder="Digite somente n√∫meros" onfocus="this.select()">

        <button type="button" class="calcular" onclick="calcularLitros(); armazenarValor()">
          Calcular
        </button>
      </form>
    </div>

    <!-- RESULTADO -->
    <div style="text-align: center;">
      <p id="resultado"></p>
      <p id="litros"></p>
    </div>

    <!-- HIST√ìRICO -->
    <center>
      _____________________________________
      <br><br>
      Hist√≥rico - √öltimos 10 Valores:
    </center>
    <div style="width: fit-content; margin: 0 auto;">
      <ul id="listaValores"></ul>
      <center>
        <button id="apagarHistorico" onclick="apagarHistorico()">Apagar Hist√≥rico</button>
      </center>
    </div>
  </div>

  <!-- POPUP DO PREMIUM -->
  <div class="popup" id="popup">
    <button id="closeButton" onclick="fecharPopup()">X</button>
    <h3>Acesso Premium</h3>
    <p>
      Adquira o acesso Premium agora! Envie um PIX de R$ 2,99 para o email guidopossi@gmail.com.
      Depois envie a imagem do comprovante no campo abaixo e ap√≥s alguns segundos ter√° o acesso liberado.
      Esse valor promocional √© por tempo limitado, n√£o perca!
    </p>
    <input type="file" id="comprovante" accept="image/*">
    <button onclick="enviarComprovante()">Enviar</button>
    <p id="timer"></p>
  </div>

  <!-- POPUP GEN√âRICO (para substituir alert/confirm) -->
  <div class="popup" id="generalPopup">
    <button id="closeButtonGeneral" onclick="fecharGeneralPopup()">X</button>
    <h3 id="generalPopupTitle"></h3>
    <p id="generalPopupMessage"></p>
    <div id="generalPopupButtons"></div>
  </div>

  <script>
    /* =======================
       FUN√á√ïES DO PREMIUM
       ======================= */
    function abrirPremium() {
      atualizarBotaoLuz();
      if (localStorage.getItem("acessoPremium")) {
        showCustomAlert("Acesso Premium", "Voc√™ j√° tem acesso premium e pode acender ou apagar a luz!");
      } else {
        exibirPopup();
      }
    }
    function exibirPopup() {
      document.getElementById("popup").style.display = "block";
    }
    function fecharPopup() {
      document.getElementById("popup").style.display = "none";
    }
    function enviarComprovante() {
      var comprovante = document.getElementById("comprovante");
      var timer = document.getElementById("timer");

      if (comprovante.files.length > 0) {
        var countdown = 15;
        timer.innerHTML = "Aguarde " + countdown + " segundos, estamos lendo seu arquivo.";
        var countdownInterval = setInterval(function () {
          countdown--;
          timer.innerHTML = "Aguarde " + countdown + " segundos, estamos lendo seu arquivo.";
          if (countdown <= 0) {
            clearInterval(countdownInterval);
            localStorage.setItem("acessoPremium", "true");
            fecharPopup();
            timer.innerHTML = "";
            showCustomAlert("Acesso Premium", "PARAB√âNS... agora voc√™ tem o acesso premium e pode acender a Luz!");
            atualizarBotaoLuz();
          }
        }, 1000);
      } else {
        showCustomAlert("Aten√ß√£o", "Por favor, selecione o arquivo da imagem do comprovante PIX.");
      }
    }

    /* ===============================
       POPUPS PERSONALIZADOS
       (substituindo alert e confirm)
       =============================== */
    const generalPopup        = document.getElementById("generalPopup");
    const generalPopupTitle   = document.getElementById("generalPopupTitle");
    const generalPopupMessage = document.getElementById("generalPopupMessage");
    const generalPopupButtons = document.getElementById("generalPopupButtons");

    // ALERTA simples (s√≥ bot√£o Ok)
    function showCustomAlert(title, message) {
      generalPopupTitle.innerText   = title;
      generalPopupMessage.innerText = message;
      // Cria bot√£o OK
      generalPopupButtons.innerHTML = "";
      const okButton = document.createElement("button");
      okButton.innerText = "OK";
      okButton.onclick = function() {
        fecharGeneralPopup();
      };
      generalPopupButtons.appendChild(okButton);

      generalPopup.style.display = "block";
    }

    // CONFIRM (bot√£o "Sim" e "N√£o")
    function showCustomConfirm(title, message, yesCallback, noCallback) {
      generalPopupTitle.innerText   = title;
      generalPopupMessage.innerText = message;
      // Limpa bot√µes
      generalPopupButtons.innerHTML = "";

      // Bot√£o SIM
      const yesBtn = document.createElement("button");
      yesBtn.innerText = "Sim";
      yesBtn.onclick = function() {
        fecharGeneralPopup();
        if (yesCallback) yesCallback();
      };

      // Bot√£o N√ÉO
      const noBtn = document.createElement("button");
      noBtn.innerText = "N√£o";
      noBtn.onclick = function() {
        fecharGeneralPopup();
        if (noCallback) noCallback();
      };

      generalPopupButtons.appendChild(yesBtn);
      generalPopupButtons.appendChild(noBtn);

      generalPopup.style.display = "block";
    }

    function fecharGeneralPopup() {
      generalPopup.style.display = "none";
    }

    /* =======================
       MODO LUZ
       ======================= */
    function atualizarBotaoLuz() {
      var luzButton = document.getElementById("luzButton");
      if (localStorage.getItem("acessoPremium")) {
        luzButton.disabled = false;
      } else {
        luzButton.disabled = true;
      }
    }
    function inverterCores() {
      var body = document.querySelector("body");
      body.classList.toggle("invert");
    }

    /* =======================
       FUN√á√ïES DE FORMATA√á√ÉO
       ======================= */
    function removerRS(valor) {
      return valor.replace(/R\$/g, "").trim();
    }
    function adicionarVirgula(campo) {
      var valor = removerRS(campo.value);
      valor = valor.replace(/\D/g, "");
      if (valor.length === 1) {
        valor = "0," + valor;
      } else if (valor.length > 1) {
        valor = parseInt(valor.slice(0, -2)) + "," + valor.slice(-2);
      }
      campo.value = "R$ " + valor;
    }
    function formatarCampo(campo) {
      var valor = removerRS(campo.value);
      valor = valor.replace(/[^0-9,]/g, "").replace(/,+/g, ",");
      if (valor.indexOf(',') === 0) {
        valor = "0" + valor;
      }
      campo.value = "R$ " + valor;
    }

    /* =======================
       C√ÅLCULO
       ======================= */
    function calcularLitros() {
      var precoGasolina = parseFloat(removerRS(document.getElementById("precoGasolina").value).replace(",", "."));
      var precoAlcool   = parseFloat(removerRS(document.getElementById("precoAlcool").value).replace(",", "."));
      var kmLitro       = parseFloat(document.getElementById("kmLitro").value);
      var distancia     = parseFloat(document.getElementById("distancia").value);

      // Exige apenas pre√ßos preenchidos:
      if (isNaN(precoGasolina) || isNaN(precoAlcool)) {
        showCustomAlert("Aten√ß√£o", "Preencha os valores de Gasolina e √Ålcool.");
        return;
      }

      // Rela√ß√£o para decidir vantagem
      var relacao          = precoAlcool / precoGasolina;
      var vantajosoAteAlc  = precoGasolina * 0.7;
      var vantajosoAteGas  = precoAlcool   / 0.7;

      var resultadoElem = document.getElementById("resultado");
      var litrosElem   = document.getElementById("litros");
      resultadoElem.innerHTML = "";
      litrosElem.innerHTML    = "";

      // Exibe mensagem de vantagem
      if (relacao > 0.7) {
        resultadoElem.innerHTML =
          "<span class='abasteca'>üëâ ABASTE√áA COM GASOLINA</span><br><br>" +
          "‚ö†Ô∏è Com base no valor informado de √°lcool (R$ " + precoAlcool.toFixed(2) +
          "), abastecer com gasolina √© vantajoso at√© R$ " + vantajosoAteGas.toFixed(2) + ".";
      } else {
        resultadoElem.innerHTML =
          "<span class='abasteca'>üëâ ABASTE√áA COM √ÅLCOOL</span><br><br>" +
          "‚ö†Ô∏è Com base no valor informado de gasolina (R$ " + precoGasolina.toFixed(2) +
          "), abastecer com √°lcool √© vantajoso at√© R$ " + vantajosoAteAlc.toFixed(2) + ".";
      }

      // Se kmLitro e distancia forem preenchidos e v√°lidos, calcular custo total
      if (!isNaN(kmLitro) && kmLitro > 0 && !isNaN(distancia) && distancia > 0) {
        var litrosNecessarios = distancia / kmLitro;
        var precoNecessGas    = litrosNecessarios * precoGasolina;
        var precoNecessAlc    = litrosNecessarios * precoAlcool;

        if (relacao > 0.7) {
          // Se gasolina for mais vantajosa
          litrosElem.innerHTML =
            "üó∫Ô∏è Para essa dist√¢ncia s√£o necess√°rios " + litrosNecessarios.toFixed(2) +
            " litros de gasolina, com um custo de R$ " + precoNecessGas.toFixed(2);
        } else {
          // Se √°lcool for mais vantajoso
          litrosElem.innerHTML =
            "üó∫Ô∏è Para essa dist√¢ncia s√£o necess√°rios " + litrosNecessarios.toFixed(2) +
            " litros de √°lcool, com um custo de R$ " + precoNecessAlc.toFixed(2);
        }
      } else {
        // Se n√£o preencheram kmLitro/distancia, apenas exibir "n√£o informado" (ou nada)
        litrosElem.innerHTML =
          "<small>KM/L e Dist√¢ncia n√£o informados, ent√£o n√£o calculamos o custo total.</small>";
      }
    }

    /* =======================
       HIST√ìRICO
       ======================= */
    function formatarDataCurta(dateObj) {
      let [dia, mes, anoLongo] = dateObj.toLocaleDateString().split("/");
      let ano = anoLongo.slice(-2);
      return `${dia}/${mes}/${ano}`;
    }

    function armazenarValor() {
      var valorGasolina = removerRS(document.getElementById("precoGasolina").value).replace(",", ".");
      var valorAlcool   = removerRS(document.getElementById("precoAlcool").value).replace(",", ".");

      var precoGasolina = parseFloat(valorGasolina);
      var precoAlcool   = parseFloat(valorAlcool);

      // Hist√≥rio exige apenas os pre√ßos de combust√≠vel
      if (isNaN(precoGasolina) || isNaN(precoAlcool)) {
        showCustomAlert("Aten√ß√£o", "Para gravar no hist√≥rico, Gasolina e √Ålcool devem ser preenchidos.");
        return;
      }

      var listaValores  = document.getElementById("listaValores");
      var dataAtualObj  = new Date();
      var dataStr       = formatarDataCurta(dataAtualObj);

      // Exemplo do registro: "07/01/25 Gasolina R$ 5.69 / √Ålcool R$ 3.89"
      var novoRegistro  = dataStr + " Gasolina R$ " + precoGasolina.toFixed(2) +
                          " / √Ålcool R$ " + precoAlcool.toFixed(2);

      // Verifica duplicidade com o √∫ltimo registro
      if (listaValores.children.length > 0) {
        var ultimoRegistro      = listaValores.firstChild.textContent;
        var ultimoRegistroTexto = ultimoRegistro.replace(" ‚ùå", "");
        if (novoRegistro === ultimoRegistroTexto) {
          return;
        }
      }

      // Cria novo <li>
      var li = document.createElement("li");
      li.innerHTML = novoRegistro + ' <span class="delete-icon" onclick="removerItem(this)">X</span>';
      listaValores.insertBefore(li, listaValores.firstChild);

      // Limita a 10 registros
      if (listaValores.children.length > 10) {
        listaValores.removeChild(listaValores.lastChild);
      }

      localStorage.setItem("valores", listaValores.innerHTML);
    }

    function removerItem(iconElement) {
      showCustomConfirm(
        "Apagar Registro",
        "Deseja apagar este registro?",
        function() {
          var li = iconElement.parentNode;
          li.parentNode.removeChild(li);
          localStorage.setItem("valores", document.getElementById("listaValores").innerHTML);
        },
        function() {
          // N√£o faz nada
        }
      );
    }

    function carregarValores() {
      var listaValores = document.getElementById("listaValores");
      listaValores.innerHTML = localStorage.getItem("valores") || "";
    }

    function apagarHistorico() {
      showCustomConfirm(
        "Apagar Hist√≥rico",
        "Deseja apagar o hist√≥rico?",
        function() {
          var listaValores = document.getElementById("listaValores");
          listaValores.innerHTML = "";
          localStorage.setItem("valores", "");
        },
        function() {
          // N√£o faz nada
        }
      );
    }
  </script>
</body>
</html>
